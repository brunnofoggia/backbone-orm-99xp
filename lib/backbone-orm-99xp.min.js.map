{"version":3,"file":"backbone-orm-99xp.min.js","sources":["../src/backbone-orm-99xp.js"],"sourcesContent":["// Backbone ORM is result of fusion between backbone and sequelize to provide a set of functionalities for business model integrated to ORM\n\n\n// CODE DOCUMENTED BELOW\n// --------------\n\n// --------------\n\n// Baseline setup\n// --------------\nimport _ from 'underscore';\nimport Backbone from 'backbone';\nimport v from 'validate-99xp';\n\nvar BackboneSequelize = {};\n\n// Extended Functionallity for Models and Collections\nvar extendedModel = {\n    preinitialize() {\n        this.setEntity();\n    },\n    setEntity() {\n        var o = _.result(this, 'entityDefinition') || (BackboneSequelize.error('Entity Definition not found')),\n                conn = this.getConnection();\n\n        return this.entity = conn.isDefined(o[0]) ?\n                conn.model(o[0]) :\n                conn.define(o[0], o[1] || {}, o[2] || {});\n    },\n    getConnection() {\n        return _.result(this, 'conn') || _.result(BackboneSequelize, 'conn') || (BackboneSequelize.error('Database connection not set'));\n    },\n    sync(method, model, o) {\n        model.trigger('request', method, model, o);\n        return this['sync' + _.ucFirst(method)](method, model, o);\n    },\n    syncRead(method, model, o) {\n        if (!this.id) {\n            return;\n        }\n\n        var success = (r) => { o.success(r.dataValues); };\n        var error = (err) => { o.error(err); };\n\n        return this.entity.findByPk(this.id)\n                .then(r => success(r))\n                .catch(err => error(err));\n    },\n    syncCreate(method, model, o) {\n        var success = (r) => {\n            var a = {};\n//            var a = r.dataValues;\n            a[model.idAttribute] = r['null'];\n            o.success(a);\n        };\n        var error = (e) => {\n            var errors = [];\n            for (let x in e.errors) {\n                errors.push(e.errors[x].message);\n            }\n            \n            o.error([errors, e]);\n        };\n        \n        var attrs = _.omit(this.attributes, this.idAttribute);\n        return this.entity.create(attrs)\n                .then(r => success(r))\n                .catch(e => error(e));\n    },\n    syncUpdate(method, model, o) {\n        var success = (r) => {\n            o.success(r[0]);\n        };\n        var error = (e) => {\n            var errors = [];\n            for (let x in e.errors) {\n                errors.push(e.errors[x].message);\n            }\n            \n            o.error([errors, e]);\n        };\n        \n        var attrs = _.omit(this.attributes, this.idAttribute);\n        var _o = {where: _.pick(this.attributes, this.idAttribute)};\n        return this.entity.update(attrs, _o)\n                .then(r => success(r))\n                .catch(e => error(e));\n    },\n    validations(a, o) {\n        return {};\n    },\n    validationErrors(err) {\n        this._res.status(400).send({\n            title: 'Dados inv√°lidos',\n            errors: err\n        });\n    }\n};\n\nBackboneSequelize.Model = Backbone.Model.extend(_.extend(_.clone(v), extendedModel));\n\nBackboneSequelize.error = function (msg) {\n    throw new Error(msg);\n};\n\nexport default BackboneSequelize;\n"],"names":["BackboneSequelize","extendedModel","preinitialize","setEntity","o","_","result","this","error","conn","getConnection","entity","isDefined","model","define","sync","method","trigger","ucFirst","syncRead","id","findByPk","then","r","success","dataValues","catch","err","syncCreate","attrs","omit","attributes","idAttribute","create","a","e","errors","x","push","message","syncUpdate","_o","where","pick","update","validations","validationErrors","_res","status","send","title","Model","Backbone","extend","clone","v","msg","Error"],"mappings":";;;;;;;;;;;mdAcA,IAAIA,EAAoB,GAGpBC,EAAgB,CAChBC,qBACSC,aAETA,gBACQC,EAAIC,EAAEC,OAAOC,KAAM,qBAAwBP,EAAkBQ,MAAM,+BAC/DC,EAAOF,KAAKG,uBAEbH,KAAKI,OAASF,EAAKG,UAAUR,EAAE,IAC9BK,EAAKI,MAAMT,EAAE,IACbK,EAAKK,OAAOV,EAAE,GAAIA,EAAE,IAAM,GAAIA,EAAE,IAAM,KAElDM,uBACWL,EAAEC,OAAOC,KAAM,SAAWF,EAAEC,OAAON,EAAmB,SAAYA,EAAkBQ,MAAM,gCAErGO,KAAKC,EAAQH,EAAOT,UAChBS,EAAMI,QAAQ,UAAWD,EAAQH,EAAOT,GACjCG,KAAK,OAASF,EAAEa,QAAQF,IAASA,EAAQH,EAAOT,IAE3De,SAASH,EAAQH,EAAOT,MACfG,KAAKa,WAOHb,KAAKI,OAAOU,SAASd,KAAKa,IACxBE,KAAKC,GAJCA,CAAAA,IAAQnB,EAAEoB,QAAQD,EAAEE,aAIhBD,CAAQD,IAClBG,MAAMC,GAJFA,CAAAA,IAAUvB,EAAEI,MAAMmB,IAITnB,CAAMmB,MAEhCC,WAAWZ,EAAQH,EAAOT,OAgBlByB,EAAQxB,EAAEyB,KAAKvB,KAAKwB,WAAYxB,KAAKyB,oBAClCzB,KAAKI,OAAOsB,OAAOJ,GACjBP,KAAKC,GAjBCA,CAAAA,QACPW,EAAI,GAERA,EAAErB,EAAMmB,aAAeT,EAAC,KACxBnB,EAAEoB,QAAQU,IAaKV,CAAQD,IAClBG,MAAMS,GAZFA,CAAAA,QACLC,EAAS,OACR,IAAIC,KAAKF,EAAEC,OACZA,EAAOE,KAAKH,EAAEC,OAAOC,GAAGE,SAG5BnC,EAAEI,MAAM,CAAC4B,EAAQD,KAMD3B,CAAM2B,KAE9BK,WAAWxB,EAAQH,EAAOT,OAalByB,EAAQxB,EAAEyB,KAAKvB,KAAKwB,WAAYxB,KAAKyB,aACrCS,EAAK,CAACC,MAAOrC,EAAEsC,KAAKpC,KAAKwB,WAAYxB,KAAKyB,qBACvCzB,KAAKI,OAAOiC,OAAOf,EAAOY,GACxBnB,KAAKC,GAfCA,CAAAA,IACXnB,EAAEoB,QAAQD,EAAE,KAcGC,CAAQD,IAClBG,MAAMS,GAbFA,CAAAA,QACLC,EAAS,OACR,IAAIC,KAAKF,EAAEC,OACZA,EAAOE,KAAKH,EAAEC,OAAOC,GAAGE,SAG5BnC,EAAEI,MAAM,CAAC4B,EAAQD,KAOD3B,CAAM2B,KAE9BU,YAAW,CAACX,EAAG9B,KACJ,IAEX0C,iBAAiBnB,QACRoB,KAAKC,OAAO,KAAKC,KAAK,CACvBC,MAAO,kBACPd,OAAQT,MAKpB3B,EAAkBmD,MAAQC,EAASD,MAAME,OAAOhD,EAAEgD,OAAOhD,EAAEiD,MAAMC,GAAItD,IAErED,EAAkBQ,MAAQ,SAAUgD,SAC1B,IAAIC,MAAMD"}