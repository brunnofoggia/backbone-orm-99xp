{"version":3,"file":"backbone-orm-99xp.js","sources":["../src/backbone-orm-99xp.js"],"sourcesContent":["// Backbone ORM is result of fusion between backbone and sequelize to provide a set of functionalities for business model integrated to ORM\n\n\n// CODE DOCUMENTED BELOW\n// --------------\n\n// --------------\n\n// Baseline setup\n// --------------\nimport _ from 'underscore';\nimport Backbone from 'backbone';\nimport v from 'validate-99xp';\n\nvar BackboneSequelize = {};\n\n// Extended Functionallity for Models and Collections\nvar extendedModel = {\n    preinitialize() {\n        this.setEntity();\n    },\n    setEntity() {\n        var o = _.result(this, 'entityDefinition') || (BackboneSequelize.error('Entity Definition not found')),\n                conn = this.getConnection();\n\n        return this.entity = conn.isDefined(o[0]) ?\n                conn.model(o[0]) :\n                conn.define(o[0], o[1] || {}, o[2] || {});\n    },\n    getConnection() {\n        return _.result(this, 'conn') || _.result(BackboneSequelize, 'conn') || (BackboneSequelize.error('Database connection not set'));\n    },\n    sync(method, model, o) {\n        model.trigger('request', method, model, o);\n        return this['sync' + _.ucFirst(method)](method, model, o);\n    },\n    syncRead(method, model, o) {\n        if (!this.id) {\n            return;\n        }\n\n        var success = (r) => { o.success(r.dataValues); };\n        var error = (err) => { o.error(err); };\n\n        return this.entity.findByPk(this.id)\n                .then(r => success(r))\n                .catch(err => error(err));\n    },\n    syncCreate(method, model, o) {\n        var success = (r) => {\n            var a = {};\n//            var a = r.dataValues;\n            a[model.idAttribute] = r['null'];\n            o.success(a);\n        };\n        var error = (e) => {\n            var errors = [];\n            for (let x in e.errors) {\n                errors.push(e.errors[x].message);\n            }\n            \n            o.error([errors, e]);\n        };\n        \n        var attrs = _.omit(this.attributes, this.idAttribute);\n        return this.entity.create(attrs)\n                .then(r => success(r))\n                .catch(e => error(e));\n    },\n    syncUpdate(method, model, o) {\n        var success = (r) => {\n            o.success(r[0]);\n        };\n        var error = (e) => {\n            var errors = [];\n            for (let x in e.errors) {\n                errors.push(e.errors[x].message);\n            }\n            \n            o.error([errors, e]);\n        };\n        \n        var attrs = _.omit(this.attributes, this.idAttribute);\n        var _o = {where: _.pick(this.attributes, this.idAttribute)};\n        return this.entity.update(attrs, _o)\n                .then(r => success(r))\n                .catch(e => error(e));\n    },\n    validations(a, o) {\n        return {};\n    },\n    validationErrors(err) {\n        this._res.status(400).send({\n            title: 'Dados inv√°lidos',\n            errors: err\n        });\n    }\n};\n\nBackboneSequelize.Model = Backbone.Model.extend(_.extend(_.clone(v), extendedModel));\n\nBackboneSequelize.error = function (msg) {\n    throw new Error(msg);\n};\n\nexport default BackboneSequelize;\n"],"names":["BackboneSequelize","extendedModel","preinitialize","setEntity","o","_","result","error","conn","getConnection","entity","isDefined","model","define","sync","method","trigger","ucFirst","syncRead","id","success","r","dataValues","err","findByPk","then","catch","syncCreate","a","idAttribute","e","errors","x","push","message","attrs","omit","attributes","create","syncUpdate","_o","where","pick","update","validations","validationErrors","_res","status","send","title","Model","Backbone","extend","clone","v","msg","Error"],"mappings":"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"}