{"version":3,"file":"backbone-orm-99xp.js","sources":["../src/backbone-orm-99xp.js"],"sourcesContent":["//Backbone ORM is result of fusion between [backbone](https://backbonejs.org) and \n//[sequelize](https://sequelize.org/) to provide a set of functionalities for business models integrated to ORM.\n// It includes an integration to provide full featured validations with [validate-99xp](https://github.com/brunnofoggia/validate-99xp)\n\n\n// Instructions\n// --------------\n\n// The array entityDefinition may have 2 or 3 items. Same options would've been passed to sequelize.define\n//  1. model name\n//  2. model definition\n//  3. model options\n\n// Before using models it's mandatory that BackboneORM receives Sequelize connection.\n// A good option would be openning a connection before your router were triggered\n\n//     BackboneORM.conn = connection\n\n// Example\n// --------------\n\n//     const EntityDefinition = ['test', {\n//         /* table columns */\n//         id: {\n//             type: Sequelize.INTEGER,\n//             primaryKey: true\n//         },\n//         name: Sequelize.STRING,\n//         age: Sequelize.INTEGER\n//     }, {\n//         freezeTableName: true, timestamps: false,\n//     }];\n//\n//     export default bborm.Model.extend({\n//         entityDefinition: EntityDefinition,\n//         validations: {\n//             \"age\": [[v8n().minLength(1).maxLength(3), 'Invalid Age']]\n//         },\n//     });\n\n// CODE DOCUMENTED BELOW\n// --------------\n\n// --------------\n\n// Baseline setup\n// --------------\nimport _ from 'underscore-99xp';\nimport Backbone from 'backbone';\nimport v from 'validate-99xp';\n\nvar BackboneORM = {};\n\nvar extended = {\n    _migration: {alter: true},\n    migration() {\n        var canMigrate = _.result(this, 'canMigrate');\n        if (!canMigrate) {\n            return false;\n        }\n        return this._migration;\n    },\n    syncMigration() {\n        var migration = _.result(this, 'migration');\n        if (!migration) {\n            return;\n        }\n        migration === true && (migration = {});\n\n        return this.entity.sync(migration);\n    },\n};\n\n// Extended Functionallity for Models and Collections\nvar extendedModel = {\n    // Pré set entity into model instance\n    preinitialize() {\n        this.setEntity();\n    },\n    // Load an instance of given class\n    setEntity() {\n        var o = _.result(this, 'entityDefinition') || (BackboneORM.error('Entity Definition not found')),\n            conn = this.getConnection();\n\n        this.entity = conn.isDefined(o[0]) ?\n            conn.model(o[0]) :\n            conn.define(o[0], o[1] || {}, o[2] || {});\n\n        return this.entity;\n    },\n    // Retrives connection object from this.conn or BackboneORM.conn\n    getConnection() {\n        return _.result(this, 'conn') || _.result(BackboneORM, 'conn') || (BackboneORM.error('Database connection not set'));\n    },\n    // Customization that redirect calls accordingly to the method asked (read, create, update, patch, delete)\n    sync(method, model, o) {\n        model.trigger('request', method, model, o);\n        return this['sync' + _.capitalize(method)](method, model, o);\n    },\n    // Get row\n    syncRead(method, model, o) {\n        // callbacks for success or error. They trigger Backbone default ones\n        var success = r => {\n            o.success(r.dataValues);\n        };\n\n        // build where\n        var data = {};\n        if (this.id) {\n            data[this.idAttribute] = this.id;\n        } else {\n            data = this.attributes;\n        }\n\n        // no where no select because this is a model not a collection\n        if (!data) {\n            return;\n        }\n\n        // run select\n        return this.entity.findOne({\n            where: data\n        }).then(r => success(r)).catch(_.bind(this.handleSyncError, this));\n    },\n    // Insert row\n    syncCreate(method, model, o) {\n        // callbacks for success or error. They trigger Backbone default ones\n        var success = (r) => {\n            var a = {};\n            /*var a = r.dataValues;*/\n            a[model.idAttribute] = r['null'];\n            o.success(a);\n        };\n\n        // remove pk from attributes that will be updated\n        var attrs = _.omit(this.attributes, this.idAttribute);\n        // run insert\n        return this.entity.create(attrs)\n            .then(r => success(r))\n            .catch(_.bind(this.handleSyncError, this));\n    },\n    // Update row\n    syncUpdate(method, model, o) {\n        // callbacks for success or error. They trigger Backbone default ones\n        var success = (r) => {\n            o.success(r[0]);\n        };\n\n        // remove pk from attributes that will be updated\n        var attrs = _.omit(this.attributes, this.idAttribute);\n        // build where\n        var _o = {\n            where: _.pick(this.attributes, this.idAttribute)\n        };\n        // run update\n        return this.entity.update(attrs, _o)\n            .then(r => success(r))\n            .catch(_.bind(this.handleSyncError, this));\n    },\n    // Patch row\n    syncPatch(method, model, o) {\n        return this.syncUpdate(method, model, o);\n    },\n    // Handle Sync Errors\n    handleSyncError(e) {\n        var errors = [];\n\n        if (_.isArray(e.errors)) {\n            for (let x in e.errors) {\n                errors.push(e.errors[x].message);\n            }\n        } else {\n            errors.push(e.message || e);\n        }\n        this.trigger('error', e, errors);\n    },\n    // Validations list. See [validate-99xp](https://github.com/brunnofoggia/validate-99xp)\n    validations(attrs, options) {\n        return {};\n    },\n    // Dispatcher of validation errors\n    validationErrors(err) {\n        this._res.status(400).send({\n            title: 'Invalid Data',\n            errors: err\n        });\n    },\n    // Allows to set a pair of listeners where one turns the other off after being executed.\n    // Both parameters are arrays composed like [event, callback]\n    once(c1, c2) {\n        if (_.isArray(c1) && _.isArray(c2)) {\n            this.once(c1[0], _.partial(function (c1, c2) {\n                this.off(c2[0], c2[1]);\n                \n                var args = _.toArray(arguments);\n                args.shift();args.shift();\n\n                c1[1].apply(null, args);\n            }, c1, c2));\n\n            this.once(c2[0], _.partial(function (c1, c2) {\n                this.off(c1[0], c1[1]);\n        \n                var args = _.toArray(arguments);\n                args.shift();args.shift();\n\n                c2[1].apply(null, args);\n            }, c1, c2));\n        }\n\n        return _.bind(Backbone.Model.prototype.once, this)(c1, c2);\n    }\n};\n\n// Extension of Backbone.Model added to custom behaviors\nBackboneORM.Model = Backbone.Model.extend(_.extend(_.clone(v), extended, extendedModel));\n\nvar extendedCollection = {\n    // Pré set entity into collection instance\n    preinitialize() {\n        this.setModelBase();\n        this.setEntity();\n    },\n    setModelBase() {\n        var ModelBase = (this.model ? this.model : BackboneORM.Model.extend());\n        this.modelBase = new ModelBase;\n    },\n    // Load an instance of given class\n    setEntity() {\n        var o = _.result(this, 'entityDefinition') || _.result(this.modelBase, 'entityDefinition') || BackboneORM.error('Entity Definition not found'),\n            conn = this.getConnection();\n\n        this.entity = conn.isDefined(o[0]) ? conn.model(o[0]) : conn.define(o[0], o[1] || {}, o[2] || {});\n        return this.entity;\n    },\n    // Retrives connection object from this.conn or BackboneORM.conn\n    getConnection() {\n        return _.result(this, 'conn') || _.result(this.modelBase, 'conn') || _.result(BackboneORM, 'conn') || BackboneORM.error('Database connection not set');\n    },\n    // Transform sequelize rows into models\n    parse(r, sc, ec) {\n        if (_.isArray(r) && _.size(r) > 0) {\n            this.add(_.map(r, (row) => {\n                return (row.dataValues);\n            }));\n        }\n\n        sc(this);\n    },\n    // find all records accordingly to the conditions\n    findAll(where = {}, sc, ec) {\n        typeof ec !== 'function' && (ec = () => { });\n\n        return this.entity.findAll({\n            where: where\n        }).then(r => this.parse(r, sc, ec)).catch(err => ec(err));\n    },\n    // Save all models\n    saveAll(sc, ec) {\n        var size = this.models.length,\n            c = () => {\n                if (--size > 0) { return; }\n                typeof sc === 'function' && sc(this);\n            };\n\n        typeof ec !== 'function' && (ec = () => { });\n\n        for (var x in this.models) {\n            var m = this.models[x];\n            m.once(['sync', c], ['error', ec]);\n            m.save();\n        }\n    }\n};\n\nBackboneORM.Collection = Backbone.Collection.extend(_.extend({}, extended, extendedCollection));\n\n\nBackboneORM.error = function (msg) {\n    throw new Error(msg);\n};\n\nexport default BackboneORM;\n"],"names":["BackboneORM","extended","_migration","alter","migration","canMigrate","_","result","syncMigration","entity","sync","extendedModel","preinitialize","setEntity","o","error","conn","getConnection","isDefined","model","define","method","trigger","capitalize","syncRead","success","r","dataValues","data","id","idAttribute","attributes","findOne","where","then","catch","bind","handleSyncError","syncCreate","a","attrs","omit","create","syncUpdate","_o","pick","update","syncPatch","e","errors","isArray","x","push","message","validations","options","validationErrors","err","_res","status","send","title","once","c1","c2","partial","off","args","toArray","arguments","shift","apply","Backbone","Model","prototype","extend","clone","v","extendedCollection","setModelBase","ModelBase","modelBase","parse","sc","ec","size","add","map","row","findAll","saveAll","models","length","c","m","save","Collection","msg","Error"],"mappings":"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"}