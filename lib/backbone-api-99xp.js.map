{"version":3,"file":"backbone-api-99xp.js","sources":["../src/backbone-api-99xp.js"],"sourcesContent":["// Micro Service integrator plus advanced validation, formatting and control over proccess possibilities\n\n\n// CODE DOCUMENTED BELOW\n// --------------\n\n// --------------\n\n// Baseline setup\n// --------------\nimport _ from 'underscore-99xp';\nimport v from 'validate-99xp';\nimport BackboneRequest from 'backbone-request-99xp';\n\nvar BackboneApi = {};\n\n// Extended Functionallity for Models and Collections\nvar extended = {\n    // not meant to be used. will be used on setting api methods like POST or PUT\n    idAttribute: '_id',\n    auth: false,\n    tokenField: 'accessToken',\n    // list of methods available in the api and their configuration (paths, validations)\n    methods: {\n        //        auth: {\n        //            public: true,\n        //            path: '/a/b',\n        //            validations: {},\n        //            data: {\n        //                user: '',\n        //                pass: '',\n        //            },\n        ////            method: {}, if I dont set it, it will use a generic one\n        //            \n        //        },\n        //        _sample: Sample\n        //        _sample: {\n        //            path: '/a/b',\n        //            validations: {}\n        //        }\n    },\n    //  default method applying JWT Auth\n    //  might be necessary to overwrite it\n    setAuthHeader(o) {\n        if (!this.tokenField) {\n            return BackboneApi.dataError('tokenField is not set');\n        }\n        o.headers.Authorization = 'Bearer ' + this.data[this.auth][this.tokenField];\n\n        return o;\n    },\n    initialize(p, o = {}) {\n        this.setRouterParameters(o.req, o.res);\n        this.options = _.defaults(_.omit(o, 'req', 'res'), {\n            autoexec: true\n        });\n        this.data = {};\n\n        typeof this.options.method === 'string' && (this.options.method = [this.options.method]);\n        this.options.autoexec && this.execAll();\n    },\n    execAll() {\n        !this._methodsExecution && (this._methodsExecution = _.clone(this.options.method));\n        if (_.size(this._methodsExecution) === 0) {\n            this._methodsExecution = null;\n            _.bind(this.options.success, this)();\n            return;\n        }\n        //        \n        var method = this._methodsExecution.shift();\n\n        this.exec(method, () => this.execAll(), this.options.error);\n    },\n    exec(method, success, error) {\n        //        !method && (method = this.options.method);\n\n        var methodData = this.methodData(method);\n\n        var vErr = this.validate(this.getMethodInput(methodData), {\n            methodData: methodData\n        });\n        if (vErr !== null) {\n            return this.validationErrors(vErr);\n        }\n\n        var fn = _.bind(this.callApi, this),\n            calledFn = _.partial(fn, method, methodData, success, error);\n        // if there's no authorization needed fn is called\n        if (methodData.public) {\n            return calledFn();\n        } else if (!this.auth) {\n            return BackboneApi.dataError(`method \"${method}\" is not set as public but auth is not set`);\n        }\n\n        return this.exec(this.auth, calledFn);\n    },\n    // used to call api and trigger callbacks accordingly\n    callApi(method, methodData, success, error) {\n        this.setApiCall(methodData);\n\n        var o = {\n            method: methodData.method,\n            data: this.getMethodInput(methodData),\n            headers: _.result2(methodData, 'headers', {}, [methodData], this)\n        };\n        if (!methodData.public) {\n            o = this.setAuthHeader(o);\n        }\n\n        var before = _.bind(typeof methodData.before === 'function' ? methodData.before : (c, _o) => {\n                c(_o);\n            }, this),\n            save = _.bind(_.partial((_method, _methodData, _success, _error, _o) => {\n                this.listenToOnce(this, 'sync', _.bind(() => {\n                    this.data[_method] = this.attributes;\n                    this.attributes = {};\n\n                    try {\n                        typeof _methodData.success === 'function' && _.bind(_methodData.success, this)(_o, this._req.body, _methodData);\n                        typeof _success === 'function' && _.bind(_success, this)(_o, this._req.body, _methodData);\n                    } catch (e) {\n                        // console.error('Internal Failure');\n                        // console.error(e);\n                        this._res.status(500).send({\n                            message: 'Internal Failure'\n                        });\n                    }\n                }, this));\n                this.listenToOnce(this, 'error', _.bind(() => {\n                    // !this._reqErr.response && console.error('Internal Failure');\n                    try {\n                        typeof _methodData.error === 'function' && _.bind(_methodData.error, this)(this._reqErr.response, _o, this._req.body, _methodData);\n                        typeof _error === 'function' ? _.bind(_error, this)(this._reqErr.response || null, _o, this._req.body, _methodData) : \n                            !this._res._headerSent && this._res.status(this._reqErr.response ? this._reqErr.response.status : 500).send(this._reqErr.response ? this._reqErr.response.data : null);\n                    } catch (e) {\n                        // console.error('Internal Failure');\n                        // console.error(e);\n                        this._res.status(500).send({\n                            message: 'Internal Failure'\n                        });\n                    }\n                }, this));\n\n                this.save(null, _o);\n            }, method, methodData, success, error), this);\n\n        try {\n            before(save, o);\n        } catch (e) {\n            // console.error('Internal Failure');\n            // console.log(e);\n            this._res.status(500).send({\n                message: 'Internal Failure'\n            });\n        }\n    },\n    test: false,\n    // getter for methods data. ensure data for method asked is set\n    methodData(method) {\n        if (!method || !_.result(this, 'methods')[method]) {\n            return BackboneApi.dataError('Make sure you\\'ve set your method and it\\'s data');\n        }\n\n        var methodData = _.result(this, 'methods')[method] || {};\n\n        if (!methodData.path) {\n            BackboneApi.dataError('Make sure you\\'ve set a path for method ' + method + '\\'');\n        }\n\n        methodData = this.setHttpMethod(methodData);\n\n        return methodData;\n    },\n    // get HTTP method from method configuration. if needed set a default HTTP method accordingly to method data input\n    setHttpMethod(methodData) {\n        var data = this.getMethodInput(methodData);\n        methodData = _.defaults(methodData, {\n            method: (typeof data === 'object' && _.size(data) > 0 ? 'POST' : 'GET')\n        });\n        methodData.method = methodData.method.toUpperCase();\n\n        return methodData;\n    },\n    // get \"data\" from method configuration (can be an object or function) or req.body instead\n    getMethodInput(methodData) {\n        return _.result2(methodData, 'data', this._req.body || {}, [_.clone(this._req.body), methodData], this);\n    },\n    // replaces common behavior of backbone to ensure no id nonwanted will be added in Api URLs\n    url() {\n        return _.result(this, 'urlRoot') ||\n            _.result(this.collection, 'url') ||\n            BackboneApi.urlError();\n    },\n    // set asked method data for the request to be executed\n    setApiCall(methodData) {\n        this.setApiUrl(methodData.path, methodData);\n    },\n    // merge urlHost with the correct path for method asked. also render path as a template to make possible having attributes on it\n    setApiUrl(path, methodData) {\n        var host = _.result(this, 'urlHost') || BackboneApi.urlError(1),\n            data = _.extend({}, _.clone(this.data), {\n                _model: this,\n                _input: this.getMethodInput(methodData),\n                _params: this._req.params\n            }),\n            pathfix = new RegExp('((?<!\\:)\\/{1,})', 'g');\n\n        path = _.template(path)(data);\n\n        return this.urlRoot = [host, path].join('/').replace(pathfix, '/');\n    },\n    sync(method, model, options) {\n        method = methodMap[options.method];\n        var args = [method, model, options];\n        return BackboneRequest.sync.apply(this, args);\n    },\n    validations(a, o) {\n        var vl = _.result2(o.methodData, 'validations', {}, [a, o], this);\n        return vl;\n    },\n    _validate() {\n        return true;\n    },\n    validationErrors(err) {\n        this._res.status(400).send({\n            title: 'Invalid Data',\n            errors: err\n        });\n    },\n    setRouterParameters(req, res) {\n        if (!req || !res) {\n            BackboneApi.dataError('Initialize requires an object with req and res (express route variables) within');\n        }\n\n        this._req = req;\n        this._res = res;\n    },\n};\n\n_.map(['Model', 'Collection'], (x) => {\n    BackboneApi[x] = BackboneRequest[x].extend(_.extend(_.clone(v), extended));\n});\n\n// Throw an error when a URL is needed, and none is supplied.\nBackboneApi.urlError = function(code) {\n    if (code === 2) {\n        BackboneApi.dataError('A \"path\" property must be specified in methods list for the current method');\n    }\n    BackboneApi.dataError('A \"urlHost\" property or function must be specified');\n};\n\n// Throw an error when some DATA is needed, and none is supplied.\nBackboneApi.dataError = function(msg) {\n    throw new Error(msg);\n};\n\n// Map from CRUD to HTTP for our default `Backbone.sync` implementation.\nvar methodMap = {\n    'POST': 'create',\n    'PUT': 'update',\n    'PATCH': 'patch',\n    'DELETE': 'delete',\n    'GET': 'read'\n};\n\n\nexport default BackboneApi;\n"],"names":["BackboneApi","extended","idAttribute","auth","tokenField","methods","setAuthHeader","o","dataError","headers","Authorization","data","initialize","p","setRouterParameters","req","res","options","_","defaults","omit","autoexec","method","execAll","_methodsExecution","clone","size","bind","success","shift","exec","error","methodData","vErr","validate","getMethodInput","validationErrors","fn","callApi","calledFn","partial","public","setApiCall","result2","before","c","_o","save","_method","_methodData","_success","_error","listenToOnce","attributes","_req","body","e","_res","status","send","message","_reqErr","response","_headerSent","test","result","path","setHttpMethod","toUpperCase","url","collection","urlError","setApiUrl","host","extend","_model","_input","_params","params","pathfix","RegExp","template","urlRoot","join","replace","sync","model","methodMap","args","BackboneRequest","apply","validations","a","vl","_validate","err","title","errors","map","x","v","code","msg","Error"],"mappings":"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"}