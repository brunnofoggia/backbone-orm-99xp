/**
* @license
* backbone-orm 99xp
* ----------------------------------
* v0.5.0
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-orm.99xp.org
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("underscore-99xp"),require("backbone"),require("validate-99xp")):"function"==typeof define&&define.amd?define(["exports","underscore-99xp","backbone","validate-99xp"],e):e((t=t||self).BackboneORM={},t._,t.Backbone,t.v)}(this,function(t,e,r,i){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i;var n={},s={preinitialize(){this.setEntity()},setEntity(){var t=e.result(this,"entityDefinition")||n.error("Entity Definition not found"),r=this.getConnection();return this.entity=r.isDefined(t[0])?r.model(t[0]):r.define(t[0],t[1]||{},t[2]||{})},getConnection(){return e.result(this,"conn")||e.result(n,"conn")||n.error("Database connection not set")},sync(t,r,i){return r.trigger("request",t,r,i),this["sync"+e.capitalize(t)](t,r,i)},syncRead(t,e,r){var i={};if(this.id?i[this.idAttribute]=this.id:i=this.attributes,i)return this.entity.findOne({where:i}).then(t=>(t=>{r.success(t.dataValues)})(t)).catch(t=>(t=>{r.error(t)})(t))},syncCreate(t,r,i){var n=e.omit(this.attributes,this.idAttribute);return this.entity.create(n).then(t=>(t=>{var e={};e[r.idAttribute]=t.null,i.success(e)})(t)).catch(t=>(t=>{var e=[];for(let r in t.errors)e.push(t.errors[r].message);i.error([e,t])})(t))},syncUpdate(t,r,i){var n=e.omit(this.attributes,this.idAttribute),s={where:e.pick(this.attributes,this.idAttribute)};return this.entity.update(n,s).then(t=>(t=>{i.success(t[0])})(t)).catch(t=>(t=>{var e=[];for(let r in t.errors)e.push(t.errors[r].message);i.error([e,t])})(t))},syncPatch(t,e,r){return this.syncUpdate(t,e,r)},validations:(t,e)=>({}),validationErrors(t){this._res.status(400).send({title:"Invalid Data",errors:t})}};n.Model=r.Model.extend(e.extend(e.clone(i),s)),n.error=function(t){throw new Error(t)},t.default=n,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-orm-99xp.min.js.map
