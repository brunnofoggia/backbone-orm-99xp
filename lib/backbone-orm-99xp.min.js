/**
* @license
* backbone-orm 99xp
* ----------------------------------
* v0.6.1
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-orm.99xp.org
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("underscore-99xp"),require("backbone"),require("validate-99xp")):"function"==typeof define&&define.amd?define(["exports","underscore-99xp","backbone","validate-99xp"],t):t((e=e||self).BackboneORM={},e._,e.Backbone,e.v)}(this,function(e,t,i,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n;var r={},s={preinitialize(){this.setEntity()},setEntity(){var e=t.result(this,"entityDefinition")||r.error("Entity Definition not found"),i=this.getConnection();return this.entity=i.isDefined(e[0])?i.model(e[0]):i.define(e[0],e[1]||{},e[2]||{})},getConnection(){return t.result(this,"conn")||t.result(r,"conn")||r.error("Database connection not set")},sync(e,i,n){return i.trigger("request",e,i,n),this["sync"+t.capitalize(e)](e,i,n)},syncRead(e,t,i){var n={};if(this.id?n[this.idAttribute]=this.id:n=this.attributes,n)return this.entity.findOne({where:n}).then(e=>(e=>{i.success(e.dataValues)})(e)).catch(e=>(e=>{i.error(e)})(e))},syncCreate(e,i,n){var r=t.omit(this.attributes,this.idAttribute);return this.entity.create(r).then(e=>(e=>{var t={};t[i.idAttribute]=e.null,n.success(t)})(e)).catch(e=>(e=>{var t=[];for(let i in e.errors)t.push(e.errors[i].message);n.error([t,e])})(e))},syncUpdate(e,i,n){var r=t.omit(this.attributes,this.idAttribute),s={where:t.pick(this.attributes,this.idAttribute)};return this.entity.update(r,s).then(e=>(e=>{n.success(e[0])})(e)).catch(e=>(e=>{var t=[];for(let i in e.errors)t.push(e.errors[i].message);n.error([t,e])})(e))},syncPatch(e,t,i){return this.syncUpdate(e,t,i)},validations:(e,t)=>({}),validationErrors(e){this._res.status(400).send({title:"Invalid Data",errors:e})},once(e,n){return t.isArray(e)&&t.isArray(n)&&(this.once(e[0],t.partial(function(e,i){this.off(i[0],i[1]);var n=t.clone(arguments);delete n[0],delete n[1],e[1].apply(null,n)},e,n)),this.once(n[0],t.partial(function(e,t){this.off(e[0],e[1]);var i=arguments;delete i[0],delete i[1],t[1].apply(null,i)},e,n))),t.bind(i.Model.prototype.once,this)(e,n)}};r.Model=i.Model.extend(t.extend(t.clone(n),s));var o={preinitialize(){this.setModelBase(),this.setEntity()},setModelBase(){var e=this.model?this.model:r.Model.extend();this.modelBase=new e},setEntity(){var e=t.result(this,"entityDefinition")||t.result(this.modelBase,"entityDefinition")||r.error("Entity Definition not found"),i=this.getConnection();return this.entity=i.isDefined(e[0])?i.model(e[0]):i.define(e[0],e[1]||{},e[2]||{})},getConnection(){return t.result(this,"conn")||t.result(this.modelBase,"conn")||t.result(r,"conn")||r.error("Database connection not set")},parse(e,i,n){t.isArray(e)&&t.size(e)>0&&this.add(t.map(e,e=>e.dataValues)),i(this)},findAll(e={},t,i){return"function"!=typeof i&&(i=(()=>{})),this.entity.findAll({where:e}).then(e=>this.parse(e,t,i)).catch(e=>i(e))},saveAll(e,t){var i=this.models.length,n=()=>{--i>0||"function"==typeof e&&e(this)};for(var r in"function"!=typeof t&&(t=(()=>{})),this.models){var s=this.models[r];s.once(["sync",n],["error",t]),s.save()}}};r.Collection=i.Collection.extend(o),r.error=function(e){throw new Error(e)},e.default=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-orm-99xp.min.js.map
